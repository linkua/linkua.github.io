<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-clock">

    <a href="/clock/" rel="section"><i class="fas fa-clock fa-fw"></i>clock</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/02/%E5%85%A8%E5%BF%97%E7%B3%BB%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/02/%E5%85%A8%E5%BF%97%E7%B3%BB%E5%88%97/" class="post-title-link" itemprop="url">全志架构嵌入式开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-02 00:00:00" itemprop="dateCreated datePublished" datetime="2024-04-02T00:00:00+08:00">2024-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="sunxi-tools"><a href="#sunxi-tools" class="headerlink" title="sunxi-tools"></a>sunxi-tools</h3><p>Sunxi-tools 是一组命令行工具，用于操作基于全志 SoC 的 ARM 设备。它们可以用于各种目的，比如在 FEX 和二进制格式之间转换，操作 PIO 设置，访问 FEL 工厂模式，以及编程 SPI 闪存。</p>
<p>今天咱们研究下如何在 Windows 环境下使用 sunxi-tools。</p>
<p>下载并解压缩</p>
<p>Zadig 用于安装 sunxi-tools windows 驱动安装。</p>
<p>Zadig USB 是一个开源的 USB 驱动程序安装工具，它允许用户更改 USB 设备的驱动程序。这个工具通常用于 Windows 操作系统，用于安装 WinUSB、libusb、usbser 等驱动程序。</p>
<p>开发板进入烧写模式</p>
<p>短路 V3S（F1C100s&#x2F;F1C200s&#x2F;V3s）板子的 spi flash 1,4 或 1,2 脚, 上电（通过 USB 线进入接入电脑）电脑检测到新的 usb 烧写设备。</p>
<h3 id="F1C100S-ARM9-ARM926EJ-S-32bit"><a href="#F1C100S-ARM9-ARM926EJ-S-32bit" class="headerlink" title="F1C100S ARM9 ARM926EJ-S 32bit"></a>F1C100S ARM9 ARM926EJ-S 32bit</h3><h3 id="H3-四核Cortex-A7-32bit"><a href="#H3-四核Cortex-A7-32bit" class="headerlink" title="H3 四核Cortex-A7 32bit"></a>H3 四核Cortex-A7 32bit</h3><p><a target="_blank" rel="noopener" href="https://www.armbian.com/nanopi-neo/">https://www.armbian.com/nanopi-neo/</a><br>镜像<br><a target="_blank" rel="noopener" href="https://github.com/armbian/community/releases/download/24.5.0-trunk.306/Armbian_community_24.5.0-trunk.306_Nanopineo_jammy_current_6.6.23.img.xz">https://github.com/armbian/community/releases/download/24.5.0-trunk.306/Armbian_community_24.5.0-trunk.306_Nanopineo_jammy_current_6.6.23.img.xz</a> root 1234</p>
<h3 id="H618-四核ARM-Cortex™-A53-64bit"><a href="#H618-四核ARM-Cortex™-A53-64bit" class="headerlink" title="H618 四核ARM Cortex™-A53  64bit"></a>H618 四核ARM Cortex™-A53  64bit</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/01/%E5%B8%B8%E7%94%A8linux%20%E5%91%BD%E4%BB%A4%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/01/%E5%B8%B8%E7%94%A8linux%20%E5%91%BD%E4%BB%A4%E8%A1%8C/" class="post-title-link" itemprop="url">linux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2024-04-01T00:00:00+08:00">2024-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="SHELL-命令"><a href="#SHELL-命令" class="headerlink" title="SHELL 命令"></a>SHELL 命令</h3><p>ls [-option] <parameter></p>
<p>-为参数， []为可选，&lt;&gt;为必须的</p>
<p>ls –help</p>
<h4 id="环境变量-PATH"><a href="#环境变量-PATH" class="headerlink" title="环境变量 PATH"></a>环境变量 PATH</h4><p>临时 export PATH&#x3D;$PATH:路径<br>永久 修改~&#x2F;.bashrc,在行尾添加或修改</p>
<h4 id="目录文件操作"><a href="#目录文件操作" class="headerlink" title="目录文件操作"></a>目录文件操作</h4><p>pwd 当前目录<br>cd -上一次目录<br>cp -rfd<br>mv<br>rm<br>cat<br>touch 修改文件的当前时间</p>
<p>-rwxrwxr-x 拥有者 组 大小 时间<br>-表示常规文件<br>d表示文件家<br>左边第一个表示拥有者<br>第二个表示同组者<br>最后一个表示其他用户</p>
<p>chmod [-R] +-rxw</p>
<p>find [pwd] &lt;”name”&gt;   查找目录中的文件</p>
<p>grep &lt;’name’&gt; * nwr   查找文本，从文本文件或管道数据流中筛选匹配的行及数据</p>
<h4 id="压缩和解压缩"><a href="#压缩和解压缩" class="headerlink" title="压缩和解压缩"></a>压缩和解压缩</h4><p>dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;test bs&#x3D;1024 count&#x3D;1024<br>tar -cvzf xxx.tar.gz xxx<br>tar -xvzf xxx.tar.gz</p>
<h4 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h4><p>ifconfig<br>####<br>vi 命令<br>一般模式 输入冒号进入命令行模式。输入i,a进入编辑模式</p>
<p>&#x2F; 从光标开始搜索，后按下n或N反方向<br>%s&#x2F;p1&#x2F;p2&#x2F;gc 全局将p1替换成p2, c代表确认    </p>
<p>yy 复制一行<br>p  粘贴<br>dd 删除一行<br>dw 删除单词<br>D 删除光标之后</p>
<p>编辑模式 按esc推出，进入一般模式</p>
<p>命令模式 wq! 保存退出， q!不保存退出</p>
<h4 id="查看内核信息"><a href="#查看内核信息" class="headerlink" title="查看内核信息"></a>查看内核信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure>

<h4 id="查看大小端"><a href="#查看大小端" class="headerlink" title="查看大小端"></a>查看大小端</h4><p>方法1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n I | od -o | head -n1 | cut -f2 -d&quot; &quot; | cut -c6</span><br></pre></td></tr></table></figure>
<p>输出：1为小端模式，0为大端模式；<br>解析：od命令的作用为将指定内容以八进制、十进制、十六进制、浮点格式或ASCII编码字符方式显示；<br>方法2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n I | od -o | head -n1 | awk &#x27;&#123;print $2&#125;&#x27;| cut -c6</span><br></pre></td></tr></table></figure>
<p>输出：1为小端模式，0为大端模式；<br>解析：awk命令为文本处理。</p>
<h4 id="安装ps命令"><a href="#安装ps命令" class="headerlink" title="安装ps命令"></a>安装ps命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install procps</span><br></pre></td></tr></table></figure>

<h4 id="查看当前系统进程"><a href="#查看当前系统进程" class="headerlink" title="查看当前系统进程"></a>查看当前系统进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep xxx</span><br></pre></td></tr></table></figure>

<h4 id="top-资源管理器"><a href="#top-资源管理器" class="headerlink" title="top 资源管理器"></a>top 资源管理器</h4><p><code>top</code>命令是一个用于实时监视Linux 系统进程、CPU使用情况、内存占用、负载情况等系统资源的命令行工具</p>
<h4 id="kill-用于杀死进程。"><a href="#kill-用于杀死进程。" class="headerlink" title="kill 用于杀死进程。"></a>kill 用于杀死进程。</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 PID</span><br></pre></td></tr></table></figure>

<h4 id="安装netstat命令"><a href="#安装netstat命令" class="headerlink" title="安装netstat命令"></a>安装netstat命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools</span><br></pre></td></tr></table></figure>

<h4 id="要查看网络服务、它们的当前状态以及它们对应的端口，请运行该命令。"><a href="#要查看网络服务、它们的当前状态以及它们对应的端口，请运行该命令。" class="headerlink" title="要查看网络服务、它们的当前状态以及它们对应的端口，请运行该命令。"></a>要查看网络服务、它们的当前状态以及它们对应的端口，请运行该命令。</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -pnltu</span><br></pre></td></tr></table></figure>

<h4 id="查看网络路由表"><a href="#查看网络路由表" class="headerlink" title="查看网络路由表"></a>查看网络路由表</h4><p>您可以使用-r选项来显示网络路由表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nr</span><br></pre></td></tr></table></figure>

<h4 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sT &#x27;/home/link/Documents/_posts/source/_posts&#x27; &#x27;/home/link/blog&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="设置-SAMBA"><a href="#设置-SAMBA" class="headerlink" title="设置 SAMBA"></a>设置 SAMBA</h4><p>安卓电视登录 UBUNTU SAMBA失败，samba4默认不再支持samba1.0版本了。<br>打开配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano -w /etc/samba/smb.conf</span><br></pre></td></tr></table></figure>
<p>在此文件的[global]中增加以下两条代码(NT1表示1.0版本）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client min protocol = NT1</span><br><span class="line">server min protocol = NT1</span><br></pre></td></tr></table></figure>
<p>更新配置生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo smbd reload</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/30/ubuntu%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/30/ubuntu%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Ubuntu</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-30T00:00:00+08:00">2024-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="更新软件源"><a href="#更新软件源" class="headerlink" title="更新软件源"></a>更新软件源</h4><p>①英文环境下，找到 software and upadate 并进入，</p>
<p>将站点变更为 China-&gt;<a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/ubuntu">http://mirrors.aliyun.com/ubuntu</a></p>
<p>②进入终端，</p>
<p>$sudo apt-get update</p>
<p>但仅仅这样，有时候还不够，可能使用 $sudo apt-get install *** 安装软件包的时候，会报错 “无法定位”：</p>
<p>③可采用更新 souces.list 文件的办法再次更新：</p>
<p>$sudo vim &#x2F;etc&#x2F;apt&#x2F;source.list</p>
<p>注意 bionic为版本代号，需要修改为当前的版本代号，使用 lsb_release -a 查看<br>将以下内容添加到文件末尾：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic universe  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates universe  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic multiverse  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates multiverse  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security universe  </span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security multiverse</span><br></pre></td></tr></table></figure>
<p>保存退出</p>
<p>④再次 $sudo apt-get update。之后报错几率就会小很多了。</p>
<h4 id="隐藏状态栏GNOME"><a href="#隐藏状态栏GNOME" class="headerlink" title="隐藏状态栏GNOME"></a>隐藏状态栏GNOME</h4><ol>
<li><p><a target="_blank" rel="noopener" href="https://extensions.gnome.org/">https://extensions.gnome.org</a> 安装浏览器插件 gnome shell集成</p>
</li>
<li><p>本地安装 sudo apt install gnome-browser-connector</p>
</li>
<li><p>打开插件搜索 hide-top-bar <a target="_blank" rel="noopener" href="https://extensions.gnome.org/extension/545/hide-top-bar/">https://extensions.gnome.org/extension/545/hide-top-bar/</a></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/28/fabric/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/28/fabric/" class="post-title-link" itemprop="url">python fabric 自动化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-28 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-28T00:00:00+08:00">2024-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a><em>作用</em></h3><p>很强大的工具</p>
<p>可以将自动化部署或者多机操作的命令固化到一个脚本里</p>
<p>和某些运维工具很像，用它主要是因为，python…..</p>
<p>简单好用易上手</p>
<p>当然，shell 各种命令组合起来也可以，上古神器和现代兵器的区别</p>
<p>网上能找到的 fabric 大多东摘西抄, 程序不能运行. 锅主要由 fabric 来背, 一开始他们并不支持 python3, 所以当 python3 流行之后, 以前针对 python2 的 fabric 教程就基本不能用了; 于是有热心程序员们搞了个非官方的 fabric3 , 写了一些教程 (很少且很多文章是错的), 但后来 fabric 官方支持了 python3 , 也出了个教程…</p>
<p>于是在互联网上至少存在 3 种 fabric 教程. 针对 python2 的, 针对非官方 python3 版本的, 还有官方 python3 官方版本的, 初学者大概会被弄得要发疯了吧…</p>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><p>在本机和目标机器安装对应包（注意，都要有）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install fabric</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>目前是 1.6 版本（或者用 pip install，一样的）</p>
<p>安装完后，可以查看是否安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ken@~$] which fab</span><br><span class="line">/usr/local/bin/fab</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>装完之后，可以浏览下<a target="_blank" rel="noopener" href="http://docs.fabfile.org/en/1.6/">官方文档</a></p>
<p>然后，可以动手了</p>
<h3 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h3><p>先进行本机简单操作，有一个初步认识，例子来源与官网</p>
<p>新建一个 py 脚本: fabfile.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def hello():</span><br><span class="line">    print(&quot;Hello world!&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>命令行执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ken@~/tmp/fab$] fab hello</span><br><span class="line">Hello world!</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意，这里可以不用 fabfile 作为文件名，但是在执行时需指定文件</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[ken@~/tmp/fab$] mv fabfile.py test.py</span><br><span class="line">fabfile.py -&gt; test.py</span><br><span class="line">[ken@~/tmp/fab$] fab hello</span><br><span class="line"></span><br><span class="line">Fatal error: Couldn&#x27;t find any fabfiles!</span><br><span class="line"></span><br><span class="line">Remember that -f can be used to specify fabfile path, and use -h for help.</span><br><span class="line"></span><br><span class="line">Aborting.</span><br><span class="line">[ken@~/tmp/fab$] fab -f test.py hello</span><br><span class="line">Hello world!</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<p>带参数：</p>
<p>修改 fabfile.py 脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def hello(name, value):</span><br><span class="line">    print(&quot;%s = %s!&quot; % (name, value))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[ken@~/tmp/fab$] fab hello:name=age,value=20</span><br><span class="line">age = 20!</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line">[ken@~/tmp/fab$] fab hello:age,20</span><br><span class="line">age = 20!</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<h3 id="执行本机操作"><a href="#执行本机操作" class="headerlink" title="执行本机操作"></a>执行本机操作</h3><p>简单的本地操作:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from fabric.api import local</span><br><span class="line"></span><br><span class="line">def lsfab():</span><br><span class="line">    local(&#x27;cd ~/tmp/fab&#x27;)</span><br><span class="line">    local(&#x27;ls&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[ken@~/tmp/fab$] pwd;ls</span><br><span class="line">/Users/ken/tmp/fab</span><br><span class="line">fabfile.py   fabfile.pyc  test.py      test.pyc</span><br><span class="line">[ken@~/tmp/fab$] fab -f test.py lsfab</span><br><span class="line">[localhost] local: cd ~/tmp/fab</span><br><span class="line">[localhost] local: ls</span><br><span class="line">fabfile.py  fabfile.pyc test.py     test.pyc</span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<p>实战开始：</p>
<p>假设，你每天要提交一份配置文件 settings.py 到版本库（这里没有考虑冲突的情况）</p>
<p>如果是手工操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /home/project/test/conf/</span><br><span class="line">git add settings.py</span><br><span class="line">git commit -m &#x27;daily update settings.py&#x27;</span><br><span class="line">git pull origin</span><br><span class="line">git push origin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也就是说，这几个命令你每天都要手动敲一次，所谓 daily job，就是每天都要重复的，机械化的工作，让我们看看用 fabric 怎么实现一键搞定：(其实用 shell 脚本可以直接搞定，但是 fab 的优势不是在这里，这里主要位后面本地 + 远端操作做准备，毕竟两个地方的操作写一种脚本便于维护)</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from fabric.api import local</span><br><span class="line"></span><br><span class="line">def setting_ci():</span><br><span class="line">    local(&quot;cd /home/project/test/conf/&quot;)</span><br><span class="line">    local(&quot;git add settings.py&quot;)</span><br><span class="line">    #后面你懂的，懒得敲了…..</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<h3 id="混搭整合远端操作"><a href="#混搭整合远端操作" class="headerlink" title="混搭整合远端操作"></a>混搭整合远端操作</h3><p>这时候，假设，你要到机器 A 的 &#x2F; home&#x2F;ken&#x2F;project 对应项目目录把配置文件更新下来</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line">from fabric.api import local,cd,run</span><br><span class="line"></span><br><span class="line">env.hosts=[&#x27;user@ip:port&#x27;,] #ssh要用到的参数</span><br><span class="line">env.password = &#x27;pwd&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def setting_ci():</span><br><span class="line">    local(&#x27;echo &quot;add and commit settings in local&quot;&#x27;)</span><br><span class="line">    #刚才的操作换到这里，你懂的</span><br><span class="line"></span><br><span class="line">def update_setting_remote():</span><br><span class="line">    print &quot;remote update&quot;</span><br><span class="line">    with cd(&#x27;~/temp&#x27;):   #cd用于进入某个目录</span><br><span class="line">        run(&#x27;ls -l | wc -l&#x27;)  #远程操作用run</span><br><span class="line"></span><br><span class="line">def update():</span><br><span class="line">    setting_ci()</span><br><span class="line">    update_setting_remote()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<p>然后，执行之：</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[ken@~/tmp/fab$] fab -f deploy.py update</span><br><span class="line">[user@ip:port] Executing task &#x27;update&#x27;</span><br><span class="line">[localhost] local: echo &quot;add and commit settings in local&quot;</span><br><span class="line">add and commit settings in local</span><br><span class="line">remote update</span><br><span class="line">[user@ip:port] run: ls -l | wc -l</span><br><span class="line">[user@ip:port] out: 12</span><br><span class="line">[user@ip:port] out:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<p>注意，如果不声明 env.password，执行到对应机器时会跳出要求输入密码的交互</p>
<h3 id="多服务器混搭"><a href="#多服务器混搭" class="headerlink" title="多服务器混搭"></a>多服务器混搭</h3><p>操作多个服务器，需要配置多个 host</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"></span><br><span class="line">from fabric.api import *</span><br><span class="line"></span><br><span class="line">#操作一致的服务器可以放在一组，同一组的执行同一套操作</span><br><span class="line">env.roledefs = &#123;</span><br><span class="line">            &#x27;testserver&#x27;: [&#x27;user1@host1:port1&#x27;,],  </span><br><span class="line">            &#x27;realserver&#x27;: [&#x27;user2@host2:port2&#x27;, ]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">#env.password = &#x27;这里不要用这种配置了，不可能要求密码都一致的，明文编写也不合适。打通所有ssh就行了&#x27;</span><br><span class="line"></span><br><span class="line">@roles(&#x27;testserver&#x27;)</span><br><span class="line">def task1():</span><br><span class="line">    run(&#x27;ls -l | wc -l&#x27;)</span><br><span class="line"></span><br><span class="line">@roles(&#x27;realserver&#x27;)</span><br><span class="line">def task2():</span><br><span class="line">    run(&#x27;ls ~/temp/ | wc -l&#x27;)</span><br><span class="line"></span><br><span class="line">def dotask():</span><br><span class="line">    execute(task1)</span><br><span class="line">    execute(task2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<p>结果：</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[ken@~/tmp/fab$] fab -f mult.py dotask</span><br><span class="line">[user1@host1:port1] Executing task &#x27;task1&#x27;</span><br><span class="line">[user1@host1:port1] run: ls -l | wc -l</span><br><span class="line">[user1@host1:port1] out: 9</span><br><span class="line">[user1@host1:port1] out:</span><br><span class="line"></span><br><span class="line">[user2@host2:port2] Executing task &#x27;task2&#x27;</span><br><span class="line">[user2@host2:port2] run: ls ~/temp/ | wc -l</span><br><span class="line">[user2@host2:port2] out: 11</span><br><span class="line">[user2@host2:port2] out:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Done.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><ol>
<li>颜色</li>
</ol>
<p>可以打印颜色，在查看操作结果信息的时候更为醒目和方便</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from fabric.colors import *</span><br><span class="line"></span><br><span class="line">def show():</span><br><span class="line">    print green(&#x27;success&#x27;)</span><br><span class="line">    print red(&#x27;fail&#x27;)</span><br><span class="line">    print yellow(&#x27;yellow&#x27;)</span><br><span class="line">#fab -f color.py show</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<ol start="2">
<li>错误和异常</li>
</ol>
<p>关于<a target="_blank" rel="noopener" href="http://docs.fabfile.org/en/1.6/usage/execution.html#failures">错误处理</a></p>
<p>默认，一组命令，上一个命令执行失败后，不会接着往下执行</p>
<p>失败后也可以进行不一样的处理， <a target="_blank" rel="noopener" href="http://docs.fabfile.org/en/1.6/tutorial.html#failure-handling">文档</a></p>
<p>目前没用到，后续用到再看了</p>
<ol start="3">
<li>密码管理</li>
</ol>
<p>看<a target="_blank" rel="noopener" href="http://docs.fabfile.org/en/1.6/usage/execution.html#password-management">文档</a></p>
<p>更好的密码管理方式，哥比较土，没打通，主要是服务器列表变化频繁，我的处理方式是：</p>
<p>1.host,user,port,password 配置列表，所有的都写在一个文件</p>
<p>或者直接搞到脚本里，当然这个更……..</p>
<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">env.hosts = [</span><br><span class="line"></span><br><span class="line">&#x27;host1&#x27;,</span><br><span class="line"></span><br><span class="line">&#x27;host2&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">env.passwords = &#123; </span><br><span class="line">&#x27;host1&#x27;: &quot;pwdofhost1&quot;,</span><br><span class="line">&#x27;host2&#x27;: &quot;pwdofhost2&quot;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> 或者</span><br><span class="line"></span><br><span class="line">env.roledefs = &#123;</span><br><span class="line">&#x27;testserver&#x27;: [&#x27;host1&#x27;, &#x27;host2&#x27;],</span><br><span class="line">&#x27;realserver&#x27;: [&#x27;host3&#x27;, ]</span><br><span class="line">&#125;</span><br><span class="line">env.passwords = &#123;</span><br><span class="line">&#x27;host1&#x27;: &quot;pwdofhost1&quot;,</span><br><span class="line">&#x27;host2&#x27;: &quot;pwdofhost2&quot;,</span><br><span class="line">&#x27;host3&#x27;: &quot;pwdofhost3&quot;, </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="javascript:void(0);" title="复制代码"><img src="http://assets.cnblogs.com/images/copycode.gif"></a></p>
<ol start="2">
<li>根据 key 解析成 map 嵌套，放到 deploy 中</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/27/%E8%A3%85%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/27/%E8%A3%85%E6%9C%BA/" class="post-title-link" itemprop="url">安装多个操作系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-27 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-27T00:00:00+08:00">2024-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>Ubuntu官网下载iso<br>Windows原版镜像: <a target="_blank" rel="noopener" href="https://hellowindows.cn/">https://hellowindows.cn/</a><br>PE工具：微PE工具箱或者FirPE <a target="_blank" rel="noopener" href="https://firpe.cn/">https://firpe.cn/</a><br>引导工具：VenToy制作U盘启动盘 <a target="_blank" rel="noopener" href="https://www.ventoy.net/cn/">https://www.ventoy.net/cn/</a></p>
<p>使用Ventoy制作U盘启动盘后，将PE工具的ISO和系统镜像ISO都放入U盘中，<br>电脑重启进入BIOS,选择从U盘启动，再启动系统镜像</p>
<h3 id="rEFInd引导"><a href="#rEFInd引导" class="headerlink" title="rEFInd引导"></a>rEFInd引导</h3><p>如果存在多个操作系统，可以使用rEFInd来管理，<br>下载refind，放入EFI分区boot中，&#x2F;boot&#x2F;EFI&#x2F;refind。<br>下载rEFInd-minimal主题，放入refind 下创建themes 文件夹中。<br>修改refind.conf文件，最后增加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include themes/rEFInd-minimal/theme.conf</span><br><span class="line">resolution 1024 768</span><br><span class="line">dont_scan_dirs /EFI/BOOT,/EFI/ubuntu</span><br></pre></td></tr></table></figure>

<p>使用分区工具diskgenius的工具或者easyUEFI增加refind启动项目，<br>过程中可能会损坏windows的BCD引导文件，用PE工具或者使用 bcdboot命令修复ESP分区中的EFI。<br>另一种方法使用<code>bcdboot c:\windows /s c:</code>在C盘创建启动文件，<br>在refind中引导，这样ESP中都不需要windows的EFI了。</p>
<h3 id="无U盘安装"><a href="#无U盘安装" class="headerlink" title="无U盘安装"></a>无U盘安装</h3><p>用分区工具分出硬盘10g大小的空间，将镜像解压到10g空间中，<br>在ESP分区安装rEFInd,重启选择安装文件的&#x2F;EFI&#x2F;BOOT启动</p>
<h3 id="kms激活-Windows"><a href="#kms激活-Windows" class="headerlink" title="kms激活 Windows"></a>kms激活 Windows</h3><p>配置好的网站，可以直接下载激活脚本：<br><a target="_blank" rel="noopener" href="https://www.moerats.com/kms/">https://www.moerats.com/kms/</a><br>长期维护网站：<br><a target="_blank" rel="noopener" href="https://kms.cangshui.net/">https://kms.cangshui.net/</a></p>
<p>管理员打开CMD命令行，依次输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">slmgr /skms kms.03k.org</span><br><span class="line"></span><br><span class="line">slmgr /ato</span><br><span class="line"></span><br><span class="line">@echo offchcp 65001&gt;nulecho 正在连接到KMS服务器...slmgr /skms kms.03k.orgecho 连接成功！正在激活电脑...slmgr /atoecho 电脑已激活！pause</span><br><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/23/onenet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/23/onenet/" class="post-title-link" itemprop="url">OneNET</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-23T00:00:00+08:00">2024-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="MQTT"><a href="#MQTT" class="headerlink" title="MQTT"></a>MQTT</h3><p>设备接入支持标准MQTTV3.1.1版本，支持TLS加密，接入服务地址如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MQTT协议 &#x27;mqtts.heclouds.com:1883&#x27;</span><br></pre></td></tr></table></figure>
<p>设备可通过MQTT connnect报文进行登录，connect报文中三要素填写方法如下：</p>
<p>参数	是否必须	参数说明<br>clientId	是	设备名称<br>username	是	平台分配的产品ID<br>password	是	填写经过 key 计算的 token</p>
<h4 id="token计算方式"><a href="#token计算方式" class="headerlink" title="token计算方式"></a>token计算方式</h4><p>打开 “tokenV2.0.exe”<br>res: products&#x2F;产品ID&#x2F;devices&#x2F;设备名称   例如：res &#x3D; products&#x2F;vUui7WOi1a&#x2F;devices&#x2F;led0<br>et: 2121957139 例如 UTC token最后有效时间 2038</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/11/TCPIP%E5%8D%8F%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/11/TCPIP%E5%8D%8F%E8%AE%AE/" class="post-title-link" itemprop="url">TCP/IP协议栈</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-11 18:26:00" itemprop="dateCreated datePublished" datetime="2024-03-11T18:26:00+08:00">2024-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="SSL-TLS-协议是什么"><a href="#SSL-TLS-协议是什么" class="headerlink" title="SSL&#x2F;TLS 协议是什么"></a>SSL&#x2F;TLS 协议是什么</h3><p>SSL 协议（Secure Sockets Layer，安全套接字层），是由网景 (Netscape) 公司在 1990 年推出的一种标准安全协议，用于在网络通信中建立 Web 浏览器和 Web 服务器之间的加密链接。</p>
<p>TLS（Transport Layer Security，传输层安全）是 IETF 组织 （工程任务组）在 1999 年将 SSL3.0 协议规范进行了标准化。</p>
<p>SSL(Secure Sockets Layer) 和 TLS(Transport Layer Security) 的关系就像 windows XP 和 windows 7 的关系，升级后改了个名字而已。</p>
<p>HTTPS&#x3D;HTTP+TLS</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/08/simpread-f1c100s%20%E8%8A%AF%E7%89%87%E4%BB%8B%E7%BB%8D%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/08/simpread-f1c100s%20%E8%8A%AF%E7%89%87%E4%BB%8B%E7%BB%8D%20/" class="post-title-link" itemprop="url">F1C100s 启动</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-08 17:29:00" itemprop="dateCreated datePublished" datetime="2024-03-08T17:29:00+08:00">2024-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-25 00:40:04" itemprop="dateModified" datetime="2024-04-25T00:40:04+08:00">2024-04-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>F1C100s 的内核是 ARM926EJ-S ，ARMv5 架构，有 MMU，没有硬件 FPU，主频默认为 408MHz；</p>
</blockquote>
<h2 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Manufacturer    Allwinner</span><br><span class="line">CPU             ARM ARM926EJ-S @ 533MHz</span><br><span class="line">                L1 Cache: 16KB Data, 32KB Instruction</span><br><span class="line">                FPU: None</span><br><span class="line">Memory          32MB Embedded DDR (F1C100s) or 64MB Embedded DDR (F1C200s)</span><br><span class="line">GPU              Custom 2D-only</span><br><span class="line">VPU              Unknown</span><br><span class="line">Video            LCD, CVBS</span><br><span class="line">Audio            DAC</span><br><span class="line">Storage          SD/MMC (SD v2.0, eMMC V4.41)</span><br><span class="line">USB              USB 2.0 OTG</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="功能框图"><a href="#功能框图" class="headerlink" title="功能框图"></a>功能框图</h2><p><img src="https://aijishu.com/img/bVbJ2K"></p>
<h2 id="典型应用"><a href="#典型应用" class="headerlink" title="典型应用"></a>典型应用</h2><p><img src="https://aijishu.com/img/bVbJ2L"></p>
<ul>
<li>F1C100s 的内核是 ARM926EJ-S ，ARMv5 架构，有 MMU，没有硬件 FPU，主频默认为 408MHz；</li>
<li>F1C100s 内置 32MB DDR1 内存；</li>
<li>F1C200s 是 F1C100s 的兄弟型号，其它特性都相同，内存容量翻倍为 64MB；</li>
</ul>
<h2 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h2><p>1、上电后, f1c100s 内部 BROM (芯片内置，无法擦除) 启动；<br>2、首先检查 SD0 有没有插卡, 如果有插卡就读卡 8k 偏移数据，是否是合法的启动数据, 如果是 BROM 引导结束, 否则进入下一步；<br>3、检测 SPI0 NOR FLASH(W25QXXX, MX25LXXX) 是否存在, 是否有合法的启动数据, 如果是 BROM 引导结束, 否则进入下一步；<br>4、检测 SPI0 NAND FLASH 是否存在, 是否有合法的启动数据, 如果是 BROM 引导结束, 否则进入下一步；<br>5、因为找不到任何可以引导的介质， 系统进入 usb fel 模式， 可以用 USB 烧录了。<br>对于 F1C100s 而言启动时寻找用户程序的位置顺序如下：</p>
<ul>
<li>SDC0 接口（PF0~PF5）上的 SD（TF）卡；</li>
<li>SPI0 接口（PC0~PC3）上的 Nor Flash；</li>
<li>SPI0 接口（PC0~PC3）上的 Nand Flash；<br>对于 SD（TF）卡而言在它上面的数据存储布局通常如下：</li>
</ul>
<table><thead><tr><th>start</th><th>sector</th><th>size</th><th>usage</th></tr></thead><tbody><tr><td>0KB</td><td>0</td><td>8KB</td><td>Unused, available for an MBR or (limited) GPT partition table</td></tr><tr><td>8KB</td><td>16</td><td>32KB</td><td>Initial SPL loader</td></tr><tr><td>40KB</td><td>80</td><td>Max 984KB</td><td>U-Boot</td></tr><tr><td>1MB</td><td>2048</td><td>-</td><td>bootfs and rootfs</td></tr></tbody></table>

<p>上面参数中 SPL 从 8K 位置开始不能动（这是由 BROM 决定的）；文件系统可以根据需要来分区，boot 分区在前，通常为 FAT 格式。</p>
<p>编译后得到 u-boot-sunxi-with-spl.bin 这个文件会拼合 spl 和 u-boot ，直接把这个文件写入到 8KB 开始的位置就行了。</p>
<p>对于 SPI Flash 而言其实和 SD（TF）卡而言差不多，最关键的就是将 u-boot-sunxi-with-spl.bin 文件放在头部，即从 0 位置开始写入；其它内容根据需求而设置，只要对应的调整 u-boot 读取启动内核时相关位置参数就行。</p>
<p>需要注意的是默认情况下 SPI Flash 最大支持 16M，更大就需要在程序中设置 bank 了。</p>
<h2 id="fel-模式"><a href="#fel-模式" class="headerlink" title="fel 模式"></a>fel 模式</h2><p>上文中可以了解到 F1C100s 要是启动外部程序均失败的话就会进入 FEL 模式，用户可以通过 USB 和芯片进行交互 。在 FEL 模式你可以直接运行 u-boot 和 linux 等，也可以将数据写入 spiflash 中（可以用作烧录固件到设备中）。</p>
<p>FEL 模式其实也就是 BROM 上的一段程序，可以在 u-boot 命令行中使用 go 0xffff0020 跳转进入。另外也可以通过在 SD（TF）卡写入下面数据来通过 SD（TF）卡启动跳转：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># sdX 为SD（TF）卡，使用 sudo fdisk -l 查看</span><br><span class="line"># 如果有自动挂载的分区则逐条使用 sudo umount /dev/sdXn 进行卸载</span><br><span class="line">wget https://github.com/linux-sunxi/sunxi-tools/raw/master/bin/fel-sdboot.sunxi</span><br><span class="line">sudo dd if=fel-sdboot.sunxi of=/dev/sdX bs=1024 seek=8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/01/python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/01/python/" class="post-title-link" itemprop="url">python 并发 爬虫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-01 00:00:01" itemprop="dateCreated datePublished" datetime="2022-01-01T00:00:01+08:00">2022-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="第37课：并发编程在爬虫中的应用"><a href="#第37课：并发编程在爬虫中的应用" class="headerlink" title="第37课：并发编程在爬虫中的应用"></a>第37课：并发编程在爬虫中的应用</h2><p>之前的课程，我们已经为大家介绍了 Python 中的多线程、多进程和异步编程，通过这三种手段，我们可以实现并发或并行编程，这一方面可以加速代码的执行，另一方面也可以带来更好的用户体验。爬虫程序是典型的 I&#x2F;O 密集型任务，对于 I&#x2F;O 密集型任务来说，多线程和异步 I&#x2F;O 都是很好的选择，因为当程序的某个部分因 I&#x2F;O 操作阻塞时，程序的其他部分仍然可以运转，这样我们不用在等待和阻塞中浪费大量的时间。下面我们以爬取“<a target="_blank" rel="noopener" href="https://image.so.com/">360图片</a>”网站的图片并保存到本地为例，为大家分别展示使用单线程、多线程和异步 I&#x2F;O 编程的爬虫程序有什么区别，同时也对它们的执行效率进行简单的对比。</p>
<p>“360图片”网站的页面使用了 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX">Ajax</a> 技术，这是很多网站都会使用的一种异步加载数据和局部刷新页面的技术。简单的说，页面上的图片都是通过 JavaScript 代码异步获取 JSON 数据并动态渲染生成的，而且整个页面还使用了瀑布式加载（一边向下滚动，一边加载更多的图片）。我们在浏览器的“开发者工具”中可以找到提供动态内容的数据接口，如下图所示，我们需要的图片信息就在服务器返回的 JSON 数据中。</p>
<img src="https://gitee.com/jackfrued/mypic/raw/master/20211205221352.png" style="zoom:50%;">

<p>例如，要获取“美女”频道的图片，我们可以请求如下所示的URL，其中参数<code>ch</code>表示请求的频道，<code>=</code>后面的参数值<code>beauty</code>就代表了“美女”频道，参数<code>sn</code>相当于是页码，<code>0</code>表示第一页（共<code>30</code>张图片），<code>30</code>表示第二页，<code>60</code>表示第三页，以此类推。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://image.so.com/zjl?ch=beauty&amp;sn=0</span><br></pre></td></tr></table></figure>

<h3 id="单线程版本"><a href="#单线程版本" class="headerlink" title="单线程版本"></a>单线程版本</h3><p>通过上面的 URL 下载“美女”频道共<code>90</code>张图片。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">example04.py - 单线程版本爬虫</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_picture</span>(<span class="params">url</span>):</span><br><span class="line">    filename = url[url.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;images/beauty/<span class="subst">&#123;filename&#125;</span>&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(resp.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;images/beauty&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;images/beauty&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        resp = requests.get(<span class="string">f&#x27;https://image.so.com/zjl?ch=beauty&amp;sn=<span class="subst">&#123;page * <span class="number">30</span>&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">            pic_dict_list = resp.json()[<span class="string">&#x27;list&#x27;</span>]</span><br><span class="line">            <span class="keyword">for</span> pic_dict <span class="keyword">in</span> pic_dict_list:</span><br><span class="line">                download_picture(pic_dict[<span class="string">&#x27;qhimg_url&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>在 macOS 或 Linux 系统上，我们可以使用<code>time</code>命令来了解上面代码的执行时间以及 CPU 的利用率，如下所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time python3 example04.py </span><br></pre></td></tr></table></figure>

<p>下面是单线程爬虫代码在我的电脑上执行的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 example04.py  2.36s user 0.39s system 12% cpu 21.578 total</span><br></pre></td></tr></table></figure>

<p>这里我们只需要关注代码的总耗时为<code>21.578</code>秒，CPU 利用率为<code>12%</code>。</p>
<h3 id="多线程版本"><a href="#多线程版本" class="headerlink" title="多线程版本"></a>多线程版本</h3><p>我们使用之前讲到过的线程池技术，将上面的代码修改为多线程版本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">example05.py - 多线程版本爬虫</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_picture</span>(<span class="params">url</span>):</span><br><span class="line">    filename = url[url.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;images/beauty/<span class="subst">&#123;filename&#125;</span>&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(resp.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;images/beauty&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;images/beauty&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">16</span>) <span class="keyword">as</span> pool:</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            resp = requests.get(<span class="string">f&#x27;https://image.so.com/zjl?ch=beauty&amp;sn=<span class="subst">&#123;page * <span class="number">30</span>&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">                pic_dict_list = resp.json()[<span class="string">&#x27;list&#x27;</span>]</span><br><span class="line">                <span class="keyword">for</span> pic_dict <span class="keyword">in</span> pic_dict_list:</span><br><span class="line">                    pool.submit(download_picture, pic_dict[<span class="string">&#x27;qhimg_url&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>执行如下所示的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time python3 example05.py</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 example05.py  2.65s user 0.40s system 95% cpu 3.193 total</span><br></pre></td></tr></table></figure>

<h3 id="异步I-O版本"><a href="#异步I-O版本" class="headerlink" title="异步I&#x2F;O版本"></a>异步I&#x2F;O版本</h3><p>我们使用<code>aiohttp</code>将上面的代码修改为异步 I&#x2F;O 的版本。为了以异步 I&#x2F;O 的方式实现网络资源的获取和写文件操作，我们首先得安装三方库<code>aiohttp</code>和<code>aiofile</code>，命令如下所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install aiohttp aiofile</span><br></pre></td></tr></table></figure>

<p><code>aiohttp</code> 的用法在之前的课程中已经做过简要介绍，<code>aiofile</code>模块中的<code>async_open</code>函数跟 Python 内置函数<code>open</code>的用法大致相同，只不过它支持异步操作。下面是异步 I&#x2F;O 版本的爬虫代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">example06.py - 异步I/O版本爬虫</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> aiofile</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_picture</span>(<span class="params">session, url</span>):</span><br><span class="line">    filename = url[url.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, ssl=<span class="literal">False</span>) <span class="keyword">as</span> resp:</span><br><span class="line">        <span class="keyword">if</span> resp.status == <span class="number">200</span>:</span><br><span class="line">            data = <span class="keyword">await</span> resp.read()</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> aiofile.async_open(<span class="string">f&#x27;images/beauty/<span class="subst">&#123;filename&#125;</span>&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                <span class="keyword">await</span> file.write(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_json</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> session.get(</span><br><span class="line">                url=<span class="string">f&#x27;https://image.so.com/zjl?ch=beauty&amp;sn=<span class="subst">&#123;page * <span class="number">30</span>&#125;</span>&#x27;</span>,</span><br><span class="line">                ssl=<span class="literal">False</span></span><br><span class="line">            ) <span class="keyword">as</span> resp:</span><br><span class="line">                <span class="keyword">if</span> resp.status == <span class="number">200</span>:</span><br><span class="line">                    json_str = <span class="keyword">await</span> resp.text()</span><br><span class="line">                    result = json.loads(json_str)</span><br><span class="line">                    <span class="keyword">for</span> pic_dict <span class="keyword">in</span> result[<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">                        <span class="keyword">await</span> download_picture(session, pic_dict[<span class="string">&#x27;qhimg_url&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;images/beauty&#x27;</span>):</span><br><span class="line">        os.makedirs(<span class="string">&#x27;images/beauty&#x27;</span>)</span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.run_until_complete(fetch_json())</span><br><span class="line">    loop.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>执行如下所示的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time python3 example06.py</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 example06.py  0.82s user 0.21s system 27% cpu 3.782 total</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过上面三段代码执行结果的比较，我们可以得出一个结论，使用多线程和异步 I&#x2F;O 都可以改善爬虫程序的性能，因为我们不用将时间浪费在因 I&#x2F;O 操作造成的等待和阻塞上，而<code>time</code>命令的执行结果也告诉我们，单线程的代码 CPU 利用率仅仅只有<code>12%</code>，而多线程版本的 CPU 利用率则高达<code>95%</code>；单线程版本的爬虫执行时间约<code>21</code>秒，而多线程和异步 I&#x2F;O 的版本仅执行了<code>3</code>秒钟。另外，在运行时间差别不大的情况下，多线程的代码比异步 I&#x2F;O 的代码耗费了更多的 CPU 资源，这是因为多线程的调度和切换也需要花费 CPU 时间。至此，三种方式在 I&#x2F;O 密集型任务上的优劣已经一目了然，当然这只是在我的电脑上跑出来的结果。如果网络状况不是很理想或者目标网站响应很慢，那么使用多线程和异步 I&#x2F;O 的优势将更为明显，有兴趣的读者可以自行试验。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/27/linuxdeploy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/27/linuxdeploy/" class="post-title-link" itemprop="url">linux deploy</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-27 00:00:01" itemprop="dateCreated datePublished" datetime="2021-01-27T00:00:01+08:00">2021-01-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-24 13:47:45" itemprop="dateModified" datetime="2024-04-24T13:47:45+08:00">2024-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="google-play"><a href="#google-play" class="headerlink" title="google play"></a>google play</h3><p>可以直接获取并下载Google Play APK的镜像站<br>Google Play官网：<a target="_blank" rel="noopener" href="https://play.google.com/store">https://play.google.com/store</a></p>
<p>1、可以直接搜索应用名并下载的，但需要爬Q<br><a target="_blank" rel="noopener" href="http://apkleecher.com/">http://apkleecher.com/</a><br><a target="_blank" rel="noopener" href="http://apk-dl.com/">http://apk-dl.com/</a><br><a target="_blank" rel="noopener" href="https://apkpure.com/">https://apkpure.com/</a><br>2、需要输入Google Play链接或者包名<br><a target="_blank" rel="noopener" href="http://www.apksmart.com/">http://www.apksmart.com/</a><br><a target="_blank" rel="noopener" href="https://tingyuan.me/apkdownload/">https://tingyuan.me/apkdownload/</a><br><a target="_blank" rel="noopener" href="https://androidappsapk.co/apkdownloader/">https://androidappsapk.co/apkdownloader/</a></p>
<h3 id="旧手机"><a href="#旧手机" class="headerlink" title="旧手机"></a>旧手机</h3><p>新手机建议安装Termux终端模拟，这里针对破铜烂铁,决定废物利用下，拿来安装inux deploy，当作VPS用，安装 fr，clash，nginx，hexo博客等。<br>屏幕大的的就安装spacedesk当作电脑副屏。<br>打扫卫生发现家里有一堆旧手机,性能排列如下：</p>
<table>
<thead>
<tr>
<th>手机型号</th>
<th>CPU</th>
<th>架构</th>
<th>指令集</th>
<th>内存</th>
<th>系统版本</th>
</tr>
</thead>
<tbody><tr>
<td>S7edge</td>
<td>骁龙820</td>
<td>Kryo</td>
<td>ARMv8</td>
<td>4+32</td>
<td>android9.0</td>
</tr>
<tr>
<td>红米5A</td>
<td>骁龙425</td>
<td>A53</td>
<td>ARMv8</td>
<td>3+32</td>
<td>android8.1</td>
</tr>
<tr>
<td>坚果</td>
<td>骁龙615</td>
<td>A53</td>
<td>ARMv8</td>
<td>2+16</td>
<td>android8.1</td>
</tr>
<tr>
<td>魅蓝metal</td>
<td>MT6795</td>
<td>A53</td>
<td>ARMv8</td>
<td>2+16</td>
<td>android5.1</td>
</tr>
<tr>
<td>魅蓝2</td>
<td>MT6735</td>
<td>A53</td>
<td>ARMv8</td>
<td>2+16</td>
<td>android5.1</td>
</tr>
<tr>
<td>大神F1</td>
<td>MT6592</td>
<td>A7</td>
<td>ARMv7</td>
<td>2+8</td>
<td>android4.4</td>
</tr>
<tr>
<td>红米NOTE</td>
<td>骁龙400</td>
<td>A7</td>
<td>ARMv7</td>
<td>2+8</td>
<td>android4.4</td>
</tr>
<tr>
<td>三星8268</td>
<td>samsung</td>
<td>A7</td>
<td>ARMv7</td>
<td>1+4</td>
<td>android4.1</td>
</tr>
</tbody></table>
<p>参考手机性能天梯图：<a target="_blank" rel="noopener" href="https://www.mydrivers.com/zhuanti/tianti/01/">https://www.mydrivers.com/zhuanti/tianti/01/</a></p>
<h4 id="Android各版本和Linux版本对应关系"><a href="#Android各版本和Linux版本对应关系" class="headerlink" title="Android各版本和Linux版本对应关系"></a>Android各版本和Linux版本对应关系</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Android Version    |API Level  |Linux Kernel in AOSP</span><br><span class="line">----------------------------------------------------</span><br><span class="line">1.5   Cupcake      |3          |2.6.27</span><br><span class="line">1.6   Donut        |4          |2.6.29</span><br><span class="line">2.0/1 Eclair       |5-7        |2.6.29</span><br><span class="line">2.2.x Froyo        |8          |2.6.32</span><br><span class="line">2.3.x Gingerbread  |9, 10      |2.6.35</span><br><span class="line">3.x.x Honeycomb    |11-13      |2.6.36</span><br><span class="line">4.0.x Ice Cream San|14, 15     |3.0.1</span><br><span class="line">4.1.x Jelly Bean   |16         |3.0.31</span><br><span class="line">4.2.x Jelly Bean   |17         |3.4.0</span><br><span class="line">4.3   Jelly Bean   |18         |3.4.39</span><br><span class="line">4.4   Kit Kat      |19, 20     |3.10</span><br><span class="line">5.x   Lollipop     |21, 22     |3.16.1</span><br><span class="line">6.0   Marshmallow  |23         |3.18.10</span><br><span class="line">7.0   Nougat       |24         |4.4.1</span><br><span class="line">7.1   Nougat       |25         |4.4.1</span><br><span class="line">8.0   Oreo         |26         |4.10</span><br><span class="line">8.1   Oreo         |27         |4.10</span><br><span class="line">9.0   Pie          |28         |4.4, 4.9 and 4.14</span><br></pre></td></tr></table></figure>

<h4 id="三星8268"><a href="#三星8268" class="headerlink" title="三星8268"></a>三星8268</h4><p>做个闹钟还可以，其他就算了。</p>
<h4 id="红米NOTE"><a href="#红米NOTE" class="headerlink" title="红米NOTE"></a>红米NOTE</h4><p>安卓4.0的砖头，没能刷入好用的5.1以上的room</p>
<h4 id="大神F1"><a href="#大神F1" class="headerlink" title="大神F1"></a>大神F1</h4><p>MT6592为32位CPU, 8个A7，主频高达1.8-2G，性能却比6735,小龙615，400好。</p>
<h4 id="魅蓝2"><a href="#魅蓝2" class="headerlink" title="魅蓝2"></a>魅蓝2</h4><p>MT6735为MTK第一代64位，4个A53 主频高达1.1-1.3G，低功耗，性能不行<br>frp-ARMv8可以用,用不了frp-ARMv7，clash—ARMv8用不了,clash-ARMv7可以用。无语。</p>
<h4 id="魅蓝metal"><a href="#魅蓝metal" class="headerlink" title="魅蓝metal"></a>魅蓝metal</h4><p>MT6795为64位8个A53，主频高达2.2G，性能可以大战小龙808了<br>还有6寸1080P大屏，可以当电脑副屏了。</p>
<h4 id="坚果"><a href="#坚果" class="headerlink" title="坚果"></a>坚果</h4><p>龙哥的艺术品，就不折腾她了，静静的躺着吧，毕竟锤子绝版了。</p>
<h4 id="红米5A"><a href="#红米5A" class="headerlink" title="红米5A"></a>红米5A</h4><p>留着以后搞，刷机发现recovery使用orangefox的,twrp官网的3.50用不了。</p>
<h4 id="S7edge"><a href="#S7edge" class="headerlink" title="S7edge"></a>S7edge</h4><p>安装Termux终端模拟。<br>高通820，功耗实在牛，就当作冬天暖手宝。<br>2k高清曲屏，拿来刷抖音，边暖手，舒服。</p>
<h3 id="刷系统"><a href="#刷系统" class="headerlink" title="刷系统"></a>刷系统</h3><p>android 5.x以上才具有安装linux deploy的价值，可能和linux内核的版本也有关吧，<br>挑选出这三台：魅蓝metal,魅蓝2,大神F1,三台都刷了flyme，安卓5.1。</p>
<p>登录flyme账户后给Kingroot权限能就能root，联网root 完，再换kingroot使用v9.9.9去除广告版来管理root权限，更清爽。</p>
<p>其中魅蓝metal，m2 为flyme 6.3，发现root 一顿操作后发现,实现开机启动，需要让手机管家.apk活着（通过手机管家唤醒自启动服务？？）,<br>而手机管家又会自动升级，甚至卸载KING root。极其恶心。<br>解决方法:直接找到&#x2F;system&#x2F;app&#x2F;中，删掉手机管家，或者一开始就在固件包中删掉它。</p>
<p>大神F1刷了flyme5.1，flyme5本是基于YUN OS的，这个版本是修改版，基于android 5.1，手机管家不会乱来。<br>但是大神的centos7 是32位的…32位的centos太难用了，很多库要找来找去的，跟不上时代了。</p>
<blockquote>
<p>注意：Android3.1之后，应用程序无法在安装后自己启动，没有ui的程序必须通过其他应用激活才能启动，如它的<code>Activity、Service、Content Provider</code>被其他应用调用。估计手机管家干这活不过，存在一种例外，就是&#x3D;&#x3D;应用程序被<code>adb push you.apk /system/app/</code>下是会自动启动的，不处于stopped状态&#x3D;&#x3D;。解决方式就是将APK推送到<code>/system/app</code>目录下,或者打包系统时，将APK放置到<code>/system/app</code> 中打包把linnux deploy 一定要安装到<code>/system/app</code>下</p>
</blockquote>
<p>总的来说，要安卓5.x以上，内核版本3.16.1，avrmv8架构才有搞头。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><ul>
<li>RomMakeTool： 奇兔刷机的低版本ROM制作工具，需要断网使用 可以修改boot.img， 打包修改ROM等。</li>
<li>root工具：magisk manager 7.0+ 或者 kingroot v999 去广告版</li>
<li>Root Explorer : 文件拷贝，删除&#x2F;system&#x2F;app下固件等</li>
<li>busybox: pro 工具包</li>
<li>linux deploy : 2.4+</li>
<li>wifi adb: 无线 adb <code>adb connect ip:5555</code></li>
<li>Scrcpy: 电脑端远程直接控制手机</li>
</ul>
<p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1zt4C5yY-1CDXZef-mIOjVg">https://pan.baidu.com/s/1zt4C5yY-1CDXZef-mIOjVg</a><br>提取码：link （链接无效了，因为被百度拉黑，限速10KB了，日了狗）</p>
<h3 id="安装-centos"><a href="#安装-centos" class="headerlink" title="安装 centos"></a>安装 centos</h3><p> CPU类型对应架构如下，新出的都是64位的啦<br> 32位：A7(ARMv7)  - armhfp<br> 64位：A53(ARMv8) - aarch64&#x2F;arm64</p>
<h3 id="配置选项"><a href="#配置选项" class="headerlink" title="配置选项"></a>配置选项</h3><ul>
<li>安装类型：目录</li>
<li>安装路径：<code>/data/centos</code> （重要）</li>
<li>用户：root</li>
<li>启用初始化系统 <code>run-parts</code>，启用 <code>SSH</code></li>
</ul>
<h3 id="设置选项"><a href="#设置选项" class="headerlink" title="设置选项"></a>设置选项</h3><ul>
<li>锁定WIFI</li>
<li>CPU唤醒</li>
<li>开机启动</li>
<li>时间戳</li>
</ul>
<h3 id="隐身恢复"><a href="#隐身恢复" class="headerlink" title="隐身恢复"></a>隐身恢复</h3><p>点了设置中的隐身模式，会找不到她了</p>
<h4 id="使用-adb-恢复"><a href="#使用-adb-恢复" class="headerlink" title="使用 adb 恢复"></a>使用 adb 恢复</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb</span><br><span class="line">shell</span><br><span class="line">su</span><br><span class="line">am start -n ru.meefik.linuxdeploy/.MainActivity</span><br></pre></td></tr></table></figure>
<h3 id="安装与启动"><a href="#安装与启动" class="headerlink" title="安装与启动"></a>安装与启动</h3><p>若安装速度慢，可以尝试直接使用备份好的gz镜像源<br>使用备份的镜像时，不要点配置，安装完就可以使用了，点配置容易出问题。<br>常用rootfs下载地址(2019.12.13)</p>
<p><a target="_blank" rel="noopener" href="http://hub.meefik.ru/rootfs/alpine_arm64.tgz">http://hub.meefik.ru/rootfs/alpine_arm64.tgz</a><br><a target="_blank" rel="noopener" href="http://hub.meefik.ru/rootfs/centos_arm64.tgz">http://hub.meefik.ru/rootfs/centos_arm64.tgz</a><br><a target="_blank" rel="noopener" href="http://hub.meefik.ru/rootfs/kali_arm64.tgz">http://hub.meefik.ru/rootfs/kali_arm64.tgz</a><br><a target="_blank" rel="noopener" href="http://hub.meefik.ru/rootfs/kalitop10_arm64.tgz">http://hub.meefik.ru/rootfs/kalitop10_arm64.tgz</a><br><a target="_blank" rel="noopener" href="http://hub.meefik.ru/rootfs/ubuntu_arm64.tgz">http://hub.meefik.ru/rootfs/ubuntu_arm64.tgz</a><br>若安装失败，尝试更换linux deploy 版本<br>tasker 启动命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># /data/data/ru.meefik.linuxdeploy/files/bin/linuxdeploy start -m</span><br></pre></td></tr></table></figure>
<h4 id="ssh-fail"><a href="#ssh-fail" class="headerlink" title="ssh fail"></a>ssh fail</h4><p>1.一般出现ssh fail的问题，是因为镜像在安装时没有安装完整，有可能是因为网络掉包、磁盘空间不够或者选择的镜像源有问题导致。</p>
<p>2.现在我们可以不通过ssh连接容器，用作者预留的通道连接容器，连接容器后再安装ssh就可以解决此问题。</p>
<p>3.具体方法如下：打开linuxdeploy，启动容器后,adb连接手机，输入一下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">cd /</span><br><span class="line">./data/data/ru.meefik.linuxdeploy/files/bin/linuxdeploy shell -u root</span><br></pre></td></tr></table></figure>

<p>4.这样就获得容器的shell了，通过这个shell安装ssh。</p>
<h4 id="rc-local-fail"><a href="#rc-local-fail" class="headerlink" title="rc.local fail"></a>rc.local fail</h4><p>如果后续出现 <code>rc.local... fail</code><br>SSH连接后，输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown root:root /etc/rc.local</span><br><span class="line">sudo chmod 755 /etc/rc.local </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh -e</span><br><span class="line">#</span><br><span class="line"># rc.local</span><br><span class="line">#</span><br><span class="line"># This script is executed at the end of each multiuser runlevel.</span><br><span class="line"># Make sure that the script will &quot;exit 0&quot; on success or any other</span><br><span class="line"># value on error.</span><br><span class="line">#</span><br><span class="line"># In order to enable or disable this script just change the execution</span><br><span class="line"># bits.</span><br><span class="line">#</span><br><span class="line"># By default this script does nothing.</span><br><span class="line"></span><br><span class="line"># webdav      </span><br><span class="line">nohup /usr/local/bin/aliyundrive-webdav &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># vlmcsd       </span><br><span class="line">nohup /usr/local/bin/vlmcsd-armv7el-uclibc-static &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># clash          </span><br><span class="line">nohup /usr/share/clash/clash -d /usr/share/clash &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># frpc           </span><br><span class="line">nohup /usr/local/bin/frpc -c /usr/local/etc/frpc.ini &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># hyperion    </span><br><span class="line">nohup /usr/share/hyperion/bin/hyperiond &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># mosquitto  </span><br><span class="line">nohup /usr/sbin/mosquitto &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># hass           </span><br><span class="line">nohup /usr/local/bin/python3.10 /usr/local/bin/hass &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>

<h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3><ol>
<li>手机设置静态IP</li>
<li>局域网内使用 Termius 工具SSH登录手机IP使用</li>
<li>传输文件安装 FileZilla 使用sftp</li>
</ol>
<h3 id="使用华为镜像源"><a href="#使用华为镜像源" class="headerlink" title="使用华为镜像源"></a>使用华为镜像源</h3><p>CentOS-AltArch的镜像地址为：<a target="_blank" rel="noopener" href="https://repo.huaweicloud.com/centos-altarch/">https://repo.huaweicloud.com/centos-altarch/</a></p>
<h3 id="无线-ADB使用"><a href="#无线-ADB使用" class="headerlink" title="无线 ADB使用"></a>无线 ADB使用</h3><p>Android 11 及更高版本支持使用 Android 调试桥 (adb) 从工作站以无线方式部署和调试应用。</p>
<h4 id="通过-WLAN-连接到设备（Android-10-及更低版本）"><a href="#通过-WLAN-连接到设备（Android-10-及更低版本）" class="headerlink" title="通过 WLAN 连接到设备（Android 10 及更低版本）"></a>通过 WLAN 连接到设备（Android 10 及更低版本）</h4><p>将 Android 设备和 adb 主机连接到这两者都可以访问的同一 WLAN 网络。请注意，并非所有接入点都适用；您可能需要使用防火墙已正确配置为支持 adb 的接入点。<br>如果您要连接到 Wear OS 设备，请关闭手机上与该设备配对的蓝牙。<br>使用 USB 线将设备连接到主机。<br>设置目标设备以监听端口 <code>5555</code> 上的 TCP&#x2F;IP 连接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb tcpip 5555</span><br></pre></td></tr></table></figure>
<p>拔掉连接目标设备的 USB 线。<br>找到 Android 设备的 IP 地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb connect device_ip_address</span><br></pre></td></tr></table></figure>
<p>确认主机已连接到目标设备：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">device_ip_address:5555 device</span><br></pre></td></tr></table></figure>
<h4 id="安装应用"><a href="#安装应用" class="headerlink" title="安装应用"></a>安装应用</h4><p>您可以使用 adb 的 install 命令在模拟器或连接的设备上安装 APK：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install path_to_apk</span><br></pre></td></tr></table></figure>
<p>在以下示例中，先获得了已连接设备的列表，然后使用其中一个设备的序列号在该设备上安装了 helloWorld.apk。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">emulator-5554 device</span><br><span class="line">emulator-5555 device</span><br><span class="line"></span><br><span class="line">$ adb -s emulator-5555 install helloWorld.apk</span><br></pre></td></tr></table></figure>
<h4 id="将文件复制到设备-从设备复制文件"><a href="#将文件复制到设备-从设备复制文件" class="headerlink" title="将文件复制到设备&#x2F;从设备复制文件"></a>将文件复制到设备&#x2F;从设备复制文件</h4><p>您可以使用 <code>pull</code> 和 <code>push</code> 命令将文件复制到设备或从设备复制文件。与 <code>install</code> 命令（仅将 APK 文件复制到特定位置）不同，使用 <code>pull</code> 和 <code>push</code> 命令可将任意目录和文件复制到设备中的任何位置。</p>
<p>如需从设备中复制某个文件或目录（及其子目录），请使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull remote local</span><br></pre></td></tr></table></figure>
<p>如需将某个文件或目录（及其子目录）复制到设备，请使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push local remote</span><br></pre></td></tr></table></figure>
<p>将 local 和 remote 替换为开发机器（本地）和设备（远程）上的目标文件&#x2F;目录的路径。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push foo.txt /sdcard/foo.txt</span><br></pre></td></tr></table></figure>

<p>停止 adb 服务器<br>在某些情况下，您可能需要终止 adb 服务器进程，然后重启以解决问题（例如，如果 adb 不响应命令）。</p>
<p>如需停止 adb 服务器，请使用 <code>adb kill-server</code> 命令。然后，您可以通过发出其他任何 adb 命令来重启服务器。</p>
<p>发出 adb 命令<br>您可以从开发机器上的命令行发出 adb 命令，也可以通过脚本发出。用法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb [-d | -e | -s serial_number] command</span><br></pre></td></tr></table></figure>
<p>如果只有一个模拟器在运行或者只连接了一个设备，系统会默认将 adb 命令发送至该设备。如果有多个模拟器正在运行并且&#x2F;或者连接了多个设备，您需要使用 -d、-e 或 -s 选项指定应向其发送命令的目标设备。</p>
<p>您可以使用以下命令来查看所有支持的 adb 命令的详细列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb --help</span><br></pre></td></tr></table></figure>

<p>更多adb操作参考 <a target="_blank" rel="noopener" href="https://developer.android.com/studio/command-line/adb">https://developer.android.com/studio/command-line/adb</a></p>
<h3 id="安卓上电开机"><a href="#安卓上电开机" class="headerlink" title="安卓上电开机"></a>安卓上电开机</h3><p>出处 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/391905516d63">https://www.jianshu.com/p/391905516d63</a></p>
<p>需要：<br>已root权限、已解BL锁<br>已root权限、已解BL锁<br>已root权限、已解BL锁</p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol>
<li><p>先用recovery备份boot分区，翻车可直接进入rec恢复boot分区。</p>
</li>
<li><p>直接修改根目录下的init.rc，无用，开机会被覆盖。</p>
</li>
</ol>
<h4 id="提取boot-img"><a href="#提取boot-img" class="headerlink" title="提取boot.img"></a>提取boot.img</h4><p>使用recovery备份的boot，存放在内置储存的根目录下，MTP导出到电脑。</p>
<h4 id="解包和修改init-rc"><a href="#解包和修改init-rc" class="headerlink" title="解包和修改init.rc"></a>解包和修改init.rc</h4><p>电脑端使用recovery的工具解包后，编辑的boot.img中的init.rc”，搜索关键词“charger”，找到下面这一段代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">on charger</span><br><span class="line">class_start charger        </span><br><span class="line">setprop sys.powerctl reboot      #加入重启命令</span><br></pre></td></tr></table></figure>

<p>保存，退出</p>
<h4 id="会刷boot-img"><a href="#会刷boot-img" class="headerlink" title="会刷boot.img"></a>会刷boot.img</h4><p>将新生成的boot.img用recovery刷回手机中，重启手机。</p>
<h3 id="电脑控制手机"><a href="#电脑控制手机" class="headerlink" title="电脑控制手机"></a>电脑控制手机</h3><p>神器：<a target="_blank" rel="noopener" href="https://github.com/Genymobile/scrcpy/releases/tag/v1.17">https://github.com/Genymobile/scrcpy/releases/tag/v1.17</a><br>手机屏幕触摸怀了，可以通过OTG连接鼠标控制,安装开源的Scrcpy 还能在电脑端直接控制手机。<br>毁掉手机屏幕前，一定要设置好允许adb调试，adb root权限，adb模拟输入，scrcpy控制，上电自动开机等。<br>根据官方介绍，Scrcpy 的特性如下：</p>
<ul>
<li>轻量级（原生，仅显示设备屏幕）</li>
<li>高性能（帧率 30〜60 fps）</li>
<li>高画质（分辨率 1920×1080 或以上）</li>
<li>低延迟（35〜70ms）</li>
<li>启动时间短（1秒内显示）</li>
<li>非侵入性（设备上未安装任何软件）</li>
</ul>
<h3 id="穿透内网"><a href="#穿透内网" class="headerlink" title="穿透内网"></a>穿透内网</h3><p>1.安装frp<br>2.修改配置，使用免费的frp服务器<a target="_blank" rel="noopener" href="https://freefrp.net/">https://freefrp.net/</a> 或其他或自建</p>
<h3 id="解决chroot下无法使用service-systemctl"><a href="#解决chroot下无法使用service-systemctl" class="headerlink" title="解决chroot下无法使用service, systemctl"></a>解决chroot下无法使用service, systemctl</h3><p>在Linux Deploy中安装的CentOS7无法使用systemctl命令,当我们使用systemctl启动服务时它提示我们,Running in chroot, ignoring request.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/smaknsk/servicectl/archive/1.0.tar.gz</span><br><span class="line">tar -xf 1.0.tar.gz -C /usr/local/lib/</span><br><span class="line">ln -s /usr/local/lib/servicectl-1.0/servicectl /usr/bin/servicectl</span><br><span class="line">ln -s /usr/local/lib/servicectl-1.0/serviced /usr/bin/serviced</span><br></pre></td></tr></table></figure>
<p>使用<br>servicectl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo servicectl action service</span><br></pre></td></tr></table></figure>
<p>‎此命令仅执行文件 &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;${service}.service中的${action}， 如果通过的操作启用或禁用，则servicectl将在 ${service}.service上创建或删除symlink以供使用服务。‎</p>
<p>参数:</p>
<p>action - 可以是 {start, stop, restart, reload, enable, disable}<br>service -在&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;文件夹中的文件</p>
<p>serviced</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo serviced action</span><br></pre></td></tr></table></figure>
<p>‎此命令执行 ${action} 为所有启用服务。‎</p>
<p>参数:</p>
<p>action -默认是start，也可以是： {start, stop, restart, reload, disable}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># inside chroot</span><br><span class="line">sudo servicectl enable mariadb</span><br><span class="line"></span><br><span class="line"># outside chroot: </span><br><span class="line"># init startup and run all enabled daemons</span><br><span class="line">sudo chroot /path/to/chroot serviced</span><br></pre></td></tr></table></figure>
<h3 id="手机改直供电"><a href="#手机改直供电" class="headerlink" title="手机改直供电"></a>手机改直供电</h3><p>手机一直插着电池，时间长了，电池会鼓包，需要修改直供电。取出电池的电池保护板，5V供正极电接BAT+，这里负极不接BAT-，接电池保护板输出的地(如果接BAT-，需要外挂充电宝才能开机)。安卓手机改了直供电，电池电量显示百分比还会随着时间减少，怀疑手机系统虚拟的，而不是电池检测电路的问题。解决方法，通过adb 设置手机一直在充电状态。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line"></span><br><span class="line">dumpsys battery set status 2</span><br></pre></td></tr></table></figure>

<h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><p>liunx deploy下的centos安装mysql5.7</p>
<ol>
<li>添加mysql用户组和mysql用户<br>2.安装依赖库</li>
<li>下载解压Mysql<br>4.配置Mysql</li>
<li>添加环境变量<br>6 mysql 初始化<br>7 mysql 启动，关闭</li>
</ol>
<p>MySQL下载地址为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://obs.cn-north-4.myhuaweicloud.com/obs-mirror-ftp4/database/mysql-5.7.27-aarch64.tar.gz</span><br></pre></td></tr></table></figure>
<ol>
<li>添加mysql用户组和mysql用户<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># groupadd mysql     //创建mysql组</span><br><span class="line"># useradd -g mysql mysql //创建mysql用户添加到mysql组</span><br><span class="line"># usermod -a -G aid_inet,aid_net_raw mysql   //添加mysql在安卓中的网络访问权限</span><br></pre></td></tr></table></figure>
2.安装依赖库<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y libaio*</span><br></pre></td></tr></table></figure></li>
<li>下载解压Mysql<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># wget https://obs.cn-north-4.myhuaweicloud.com/obs-mirror-ftp4/database/mysql-5.7.27-aarch64.tar.gz</span><br><span class="line"># tar -xvf mysql-5.7.27-aarch64.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure>
4.配置Mysql<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># mv /usr/local/mysql-5.7.27-aarch64 /usr/local/mysql</span><br><span class="line"># mkdir -p /usr/local/mysql/logs</span><br><span class="line"># chown -R mysql:mysql /usr/local/mysql </span><br><span class="line"># ln -sf /usr/local/mysql/my.cnf /etc/my.cnf</span><br><span class="line"># cp -rf /usr/local/mysql/extra/lib* /usr/lib64/ </span><br><span class="line"># mv /usr/lib64/libstdc++.so.6 /usr/lib64/libstdc++.so.6.old</span><br><span class="line"># ln -s /usr/lib64/libstdc++.so.6.0.24 /usr/lib64/libstdc++.so.6</span><br></pre></td></tr></table></figure></li>
<li>添加环境变量<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/profile</span><br></pre></td></tr></table></figure>
添加下面两行代码：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export MYSQL_HOME=/usr/local/mysql</span><br><span class="line">export PATH=$PATH:$MYSQL_HOME/bin</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># source /etc/profile</span><br></pre></td></tr></table></figure>
6 mysql 初始化<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data</span><br></pre></td></tr></table></figure>
1<br>7 mysql 启动，关闭<br>方法一（不行，提示chroot）<br>设置开机启动<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cp -rf /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld </span><br><span class="line"># chmod +x /etc/init.d/mysqld</span><br><span class="line"># service mysqld start  #启动</span><br><span class="line"># service mysqld stop  #关闭</span><br></pre></td></tr></table></figure>
都可使用的指令 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld &#123;start|stop|restart|reload|force-reload|status&#125;</span><br></pre></td></tr></table></figure>
方法二（使用rc.local nohup &amp;）<br>新建&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;support-files&#x2F;startmysql.sh<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">nohup /usr/local/mysql/support-files/mysql.server start &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
在rc.local增加<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mysql</span><br><span class="line">sh /usr/local/mysql/support-files/startmysql.sh</span><br></pre></td></tr></table></figure></li>
</ol>
<p>8 登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># msyql -u root </span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这个安装是免密登录的</p>
<h3 id="安装-Homeassistant"><a href="#安装-Homeassistant" class="headerlink" title="安装 Homeassistant"></a>安装 Homeassistant</h3><p>Home Assistant时会报错版本过低，所以这里采用编译源码的方式安装Python3.9.13和Sqlite3.39.0</p>
<h4 id="先安装依赖"><a href="#先安装依赖" class="headerlink" title="先安装依赖"></a>先安装依赖</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt upgrade -y</span><br><span class="line">sudo apt install -y gcc wget build-essential zlib1g-dev libbz2-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev libjpeg-dev autoconf libopenjp2-7 libtiff5 libturbojpeg0-dev tzdata</span><br></pre></td></tr></table></figure>
<h4 id="安装Sqlite"><a href="#安装Sqlite" class="headerlink" title="安装Sqlite"></a>安装Sqlite</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.sqlite.org/2022/sqlite-autoconf-3390000.tar.gz</span><br><span class="line">tar -zxvf sqlite-autoconf-3390000.tar.gz</span><br><span class="line">cd sqlite-autoconf-3390000</span><br><span class="line">./configure</span><br><span class="line">sudo make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>查看当前Sqlite版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 --version</span><br></pre></td></tr></table></figure>
<h4 id="安装Python"><a href="#安装Python" class="headerlink" title="安装Python"></a>安装Python</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf Python-3.9.13.tgz</span><br><span class="line">cd Python-3.9.13</span><br></pre></td></tr></table></figure>
<p>Python编译链接使用刚安装的Sqlite版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LD_RUN_PATH=/usr/local/lib ./configure LDFLAGS=&quot;-L/usr/local/lib&quot; CPPFLAGS=&quot;-I/usr/local/include&quot;</span><br><span class="line">LD_RUN_PATH=/usr/local/lib make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>查看当前Python版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -V</span><br><span class="line">pip3 -V</span><br></pre></td></tr></table></figure>
<p>查看Python使用的Sqlite版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python3</span><br><span class="line">&gt;&gt;&gt; import sqlite3</span><br><span class="line">&gt;&gt;&gt; sqlite3.sqlite_version</span><br><span class="line">&#x27;3.39.0&#x27;</span><br><span class="line">&gt;&gt;&gt; quit()</span><br></pre></td></tr></table></figure>
<h4 id="安装-hass"><a href="#安装-hass" class="headerlink" title="安装 hass"></a>安装 hass</h4><ol>
<li>先安装docker，再安装hass</li>
<li>直接安装</li>
<li>官方文档：<br><a target="_blank" rel="noopener" href="https://www.home-assistant.io/installation/linux#install-home-assistant-core">https://www.home-assistant.io/installation/linux#install-home-assistant-core</a><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /srv/homeassistant</span><br><span class="line">cd /srv/homeassistant</span><br><span class="line">python3 -m venv .</span><br><span class="line">source bin/activate</span><br></pre></td></tr></table></figure>
激活虚拟环境后会变成这样</li>
</ol>
<p>(homeassistant) root@localhost:&#x2F;srv&#x2F;homeassistant#<br>再次检查一下虚拟环境中的版本信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -V</span><br><span class="line">pip3 -V</span><br></pre></td></tr></table></figure>
<p>更新一下pip版本，并改成国内源加快一下下载速度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --upgrade pip</span><br><span class="line">pip3 config set global.index-url https://mirrors.aliyun.com/pypi/simple/</span><br></pre></td></tr></table></figure>
<p>更新一下setuptools和wheel的版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --upgrade setuptools</span><br><span class="line">python3 -m pip install --upgrade wheel</span><br></pre></td></tr></table></figure>
<p>安装Home Assistant</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install homeassistant</span><br></pre></td></tr></table></figure>
<p>启动Home Assistant</p>
<p>hass<br>注：首次启动Home Assistant时会下载一些依赖，所以启动时间会较长，访问<a href="http://x.x.x.x:8123时会出现无法访问是正常现象，说明HA还没启动完成">http://x.x.x.x:8123时会出现无法访问是正常现象，说明HA还没启动完成</a></p>
<p>后面会用到的一些命令就贴在这儿了</p>
<p>后台运行hass</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup hass &gt; hass.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>tail查看日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail hass.log</span><br></pre></td></tr></table></figure>
<p>以后ssh连接后可以直接执行以下命令激活虚拟环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /srv/homeassistant/bin/activate</span><br></pre></td></tr></table></figure>
<p>退出虚拟环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate </span><br></pre></td></tr></table></figure>

<h3 id="Hyperion-grabber"><a href="#Hyperion-grabber" class="headerlink" title="Hyperion grabber"></a>Hyperion grabber</h3><p>start the grabber in home assistant with the androidtv integration</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service: androidtv.adb_command</span><br><span class="line">data:</span><br><span class="line">  command: &quot;am start com.abrenoch.hyperiongrabber/com.abrenoch.hyperiongrabber.common.BootActivity&quot;</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
